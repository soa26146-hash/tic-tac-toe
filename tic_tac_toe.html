<!DOCTYPE html>
<html lang="ar" >
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ù„Ø¹Ø¨Ø© Ø¥ÙƒØ³ Ø£Ùˆ Ù…Ø¹ Ø£Ø³Ù…Ø§Ø¡ ÙˆØªØ±ØªÙŠØ¨ - Ù…Ø­Ù…Ø¯ Ø§Ù„Ù…ØµØ±ÙŠ</title>
  <style>
    body {
      margin: 0; padding: 0;
      background: linear-gradient(135deg, #1e1e2f, #0d0d14);
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      color: #eee;
      display: flex; flex-direction: column; align-items: center; justify-content: flex-start;
      min-height: 100vh;
      user-select: none;
      padding: 20px 0;
    }
    h1 {
      margin-bottom: 5px;
      color: #7b40ff;
      text-shadow: 0 0 15px #d18aff;
    }
    #developer {
      margin-bottom: 20px;
      color: #d18aff;
      font-weight: bold;
    }
    #board {
      display: grid;
      grid-template-columns: repeat(3, 120px);
      grid-gap: 15px;
      background: #2a2a3d;
      padding: 20px;
      border-radius: 15px;
      box-shadow: 0 0 25px #7b40ff;
    }
    .cell {
      width: 120px; height: 120px;
      background: linear-gradient(145deg, #1c1c2b, #313147);
      border-radius: 15px;
      font-size: 5rem;
      color: #7b40ff;
      display: flex; justify-content: center; align-items: center;
      cursor: pointer;
      box-shadow: 5px 5px 10px #151522, -5px -5px 10px #3a3a56;
      transition: all 0.3s ease;
    }
    .cell:hover {
      color: #d18aff;
      box-shadow: 0 0 20px #d18aff;
      transform: scale(1.05);
      background: #3e3e59;
    }
    #message {
      margin-top: 20px;
      font-size: 1.4rem;
      min-height: 40px;
      text-align: center;
      font-weight: bold;
      text-shadow: 0 0 10px #d18aff;
    }
    #resetBtn {
      margin-top: 20px;
      padding: 10px 40px;
      font-size: 1.2rem;
      font-weight: bold;
      color: white;
      background: linear-gradient(135deg, #7b40ff, #d18aff);
      border: none;
      border-radius: 30px;
      cursor: pointer;
      box-shadow: 0 5px 15px #d18aff;
      transition: background 0.3s ease;
    }
    #resetBtn:hover {
      background: linear-gradient(135deg, #d18aff, #7b40ff);
      box-shadow: 0 8px 25px #7b40ff;
    }
    #levelSelectContainer {
      margin-top: 15px;
      font-weight: bold;
      color: #d18aff;
    }
    select {
      background: #2a2a3d;
      color: #eee;
      border: none;
      border-radius: 10px;
      padding: 6px 12px;
      font-weight: 700;
      box-shadow: inset 0 0 8px #7b40ff;
      cursor: pointer;
      transition: background 0.3s ease;
      margin-left: 10px;
      user-select: none;
    }
    #leaderboard {
      margin-top: 30px;
      width: 300px;
      background: #2a2a3d;
      border-radius: 15px;
      padding: 15px;
      box-shadow: 0 0 25px #7b40ff;
      color: #d18aff;
      font-weight: bold;
    }
    #leaderboard h2 {
      text-align: center;
      margin-bottom: 10px;
      color: #d18aff;
      text-shadow: 0 0 15px #7b40ff;
    }
    #leaderboard ul {
      list-style: none;
      padding: 0;
      max-height: 200px;
      overflow-y: auto;
    }
    #leaderboard li {
      padding: 6px 10px;
      border-bottom: 1px solid #7b40ff66;
      display: flex;
      justify-content: space-between;
    }
  </style>
</head>
<body>

  <h1>Ù„Ø¹Ø¨Ø© Ø¥ÙƒØ³ Ø£Ùˆ</h1>
  <div id="developer">ØªØ·ÙˆÙŠØ±: Ù…Ø­Ù…Ø¯ Ø§Ù„Ù…ØµØ±ÙŠ</div>

  <label for="playerName" style="font-weight:bold; margin-bottom:8px; color:#d18aff;">
    Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ (Ø§Ù„Ù„Ø§Ø¹Ø¨ X):
  </label>
  <input id="playerName" type="text" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù…Ùƒ Ù‡Ù†Ø§" style="padding:8px 12px; border-radius:10px; border:none; width:200px; margin-bottom:15px; font-weight:bold; font-size:1rem; background:#2a2a3d; color:#eee; box-shadow: inset 0 0 8px #7b40ff;" />

  <div id="board">
    <div class="cell" data-index="0"></div>
    <div class="cell" data-index="1"></div>
    <div class="cell" data-index="2"></div>
    <div class="cell" data-index="3"></div>
    <div class="cell" data-index="4"></div>
    <div class="cell" data-index="5"></div>
    <div class="cell" data-index="6"></div>
    <div class="cell" data-index="7"></div>
    <div class="cell" data-index="8"></div>
  </div>

  <div id="message">Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ Ø«Ù… Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù„Ø¹Ø¨!</div>

  <div id="levelSelectContainer">
    Ø§Ø®ØªØ± Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ: 
    <select id="aiLevel">
      <option value="easy">Ø³Ù‡Ù„</option>
      <option value="medium" selected>Ù…ØªÙˆØ³Ø·</option>
      <option value="hard">ØµØ¹Ø¨</option>
    </select>
  </div>

  <button id="resetBtn" disabled>Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù„Ø¹Ø¨Ø©</button>

  <div id="leaderboard">
    <h2>Ø¬Ø¯ÙˆÙ„ Ø§Ù„ØªØ±ØªÙŠØ¨</h2>
    <ul id="leaderboardList"></ul>
  </div>

  <script>
    const cells = document.querySelectorAll('.cell');
    const message = document.getElementById('message');
    const resetBtn = document.getElementById('resetBtn');
    const aiLevelSelect = document.getElementById('aiLevel');
    const playerNameInput = document.getElementById('playerName');
    const leaderboardList = document.getElementById('leaderboardList');

    let boardState = ['', '', '', '', '', '', '', '', ''];
    let currentPlayer = 'X';
    let gameActive = false; // Ù†Ù†ØªØ¸Ø± Ø§Ø³Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨
    let aiLevel = 'medium';
    let playerName = '';
    let leaderboard = {};

    // ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ±ØªÙŠØ¨ Ù…Ù† localStorage
    function loadLeaderboard() {
      const data = localStorage.getItem('xo_leaderboard');
      if (data) {
        leaderboard = JSON.parse(data);
      } else {
        leaderboard = {};
      }
    }

    // Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ±ØªÙŠØ¨ ÙÙŠ localStorage
    function saveLeaderboard() {
      localStorage.setItem('xo_leaderboard', JSON.stringify(leaderboard));
    }

    // ØªØ­Ø¯ÙŠØ« Ø¹Ø±Ø¶ Ø¬Ø¯ÙˆÙ„ Ø§Ù„ØªØ±ØªÙŠØ¨
    function updateLeaderboardDisplay() {
      loadLeaderboard();
      let entries = Object.entries(leaderboard);
      // ØªØ±ØªÙŠØ¨ ØªÙ†Ø§Ø²Ù„ÙŠ Ø­Ø³Ø¨ Ø¹Ø¯Ø¯ Ø§Ù„ÙÙˆØ²
      entries.sort((a, b) => b[1] - a[1]);
      leaderboardList.innerHTML = '';
      if (entries.length === 0) {
        leaderboardList.innerHTML = '<li>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø¹Ø¯</li>';
        return;
      }
      for (const [name, wins] of entries) {
        const li = document.createElement('li');
        li.textContent = `${name}`;
        const span = document.createElement('span');
        span.textContent = `ÙÙˆØ²: ${wins}`;
        li.appendChild(span);
        leaderboardList.appendChild(li);
      }
    }

    // ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ø³Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨ Ù„ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù„Ø¹Ø¨Ø©
    playerNameInput.addEventListener('input', () => {
      const val = playerNameInput.value.trim();
      if (val.length > 0) {
        playerName = val;
        message.textContent = `Ø¯ÙˆØ± Ø§Ù„Ù„Ø§Ø¹Ø¨ ${playerName} (X)`;
        resetBtn.disabled = false;
        if (!gameActive) {
          startGame();
        }
      } else {
        message.textContent = 'Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ Ø«Ù… Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù„Ø¹Ø¨!';
        resetBtn.disabled = true;
        gameActive = false;
      }
    });

    aiLevelSelect.addEventListener('change', () => {
      aiLevel = aiLevelSelect.value;
      resetGame();
    });

    function checkWinner(board, player) {
      const winningConditions = [
        [0,1,2],[3,4,5],[6,7,8],
        [0,3,6],[1,4,7],[2,5,8],
        [0,4,8],[2,4,6]
      ];
      return winningConditions.some(condition => {
        return condition.every(index => board[index] === player);
      });
    }

    function checkDraw(board) {
      return board.every(cell => cell !== '');
    }

    function getAvailableMoves(board) {
      return board.map((cell, idx) => cell === '' ? idx : null).filter(i => i !== null);
    }

    function makeMove(index, player) {
      boardState[index] = player;
      cells[index].textContent = player;
    }

    function handleClick(e) {
      if (!gameActive) return;
      if (currentPlayer !== 'X') return; // Ø§Ù„Ù„Ø§Ø¹Ø¨ Ø§Ù„Ø¨Ø´Ø±ÙŠ ÙŠÙ„Ø¹Ø¨ X ÙÙ‚Ø·

      const idx = parseInt(e.target.getAttribute('data-index'));
      if (boardState[idx] !== '') return;

      makeMove(idx, currentPlayer);

      if (checkWinner(boardState, currentPlayer)) {
        message.textContent = `Ø§Ù„Ù„Ø§Ø¹Ø¨ ${playerName} ÙØ§Ø²! ğŸ‰`;
        gameActive = false;
        updateLeaderboard(playerName);
        updateLeaderboardDisplay();
        return;
      }

      if (checkDraw(boardState)) {
        message.textContent = 'ØªØ¹Ø§Ø¯Ù„! ğŸ¤';
        gameActive = false;
        return;
      }

      currentPlayer = 'O';
      message.textContent = `Ø¯ÙˆØ± Ø§Ù„Ù„Ø§Ø¹Ø¨ Ø§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ± (O)`;

      // Ø­Ø±ÙƒØ© Ø§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ±
      setTimeout(() => {
        aiMove();
      }, 700);
    }

    function aiMove() {
      if (!gameActive) return;

      let move;

      if (aiLevel === 'easy') {
        const available = getAvailableMoves(boardState);
        move = available[Math.floor(Math.random() * available.length)];
      } else if (aiLevel === 'medium') {
        move = findWinningMove(boardState, 'O');
        if (move === null) {
          move = findWinningMove(boardState, 'X');
        }
        if (move === null) {
          const available = getAvailableMoves(boardState);
          move = available[Math.floor(Math.random() * available.length)];
        }
      } else {
        move = minimax(boardState, 'O').index;
      }

      makeMove(move, 'O');

      if (checkWinner(boardState, 'O')) {
        message.textContent = `Ø§Ù„Ù„Ø§Ø¹Ø¨ Ø§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ± (O) ÙØ§Ø²! ğŸ‰`;
        gameActive = false;
        return;
      }

      if (checkDraw(boardState)) {
        message.textContent = 'ØªØ¹Ø§Ø¯Ù„! ğŸ¤';
        gameActive = false;
        return;
      }

      currentPlayer = 'X';
      message.textContent = `Ø¯ÙˆØ± Ø§Ù„Ù„Ø§Ø¹Ø¨ ${playerName} (X)`;
    }

    function findWinningMove(board, player) {
      for (const idx of getAvailableMoves(board)) {
        let copy = [...board];
        copy[idx] = player;
        if (checkWinner(copy, player)) {
          return idx;
        }
      }
      return null;
    }

    function minimax(newBoard, player) {
      const huPlayer = 'X';
      const aiPlayer = 'O';

      const availSpots = getAvailableMoves(newBoard);

      if (checkWinner(newBoard, huPlayer)) {
        return {score: -10};
      } else if (checkWinner(newBoard, aiPlayer)) {
        return {score: 10};
      } else if (availSpots.length === 0) {
        return {score: 0};
      }

      let moves = [];

      for (let i = 0; i < availSpots.length; i++) {
        let move = {};
        move.index = availSpots[i];
        newBoard[availSpots[i]] = player;

        if (player === aiPlayer) {
          let result = minimax(newBoard, huPlayer);
          move.score = result.score;
        } else {
          let result = minimax(newBoard, aiPlayer);
          move.score = result.score;
        }

        newBoard[availSpots[i]] = '';

        moves.push(move);
      }

      let bestMove;
      if (player === aiPlayer) {
        let bestScore = -Infinity;
        for (let i=0; i<moves.length; i++) {
          if (moves[i].score > bestScore) {
            bestScore = moves[i].score;
            bestMove = moves[i];
          }
        }
      } else {
        let bestScore = Infinity;
        for (let i=0; i<moves.length; i++) {
          if (moves[i].score < bestScore) {
            bestScore = moves[i].score;
            bestMove = moves[i];
          }
        }
      }

      return bestMove;
    }

    function updateLeaderboard(name) {
      leaderboard[name] = (leaderboard[name] || 0) + 1;
      saveLeaderboard();
    }

    function startGame() {
      boardState.fill('');
      cells.forEach(cell => cell.textContent = '');
      currentPlayer = 'X';
      gameActive = true;
      message.textContent = `Ø¯ÙˆØ± Ø§Ù„Ù„Ø§Ø¹Ø¨ ${playerName} (X)`;
    }

    function resetGame() {
      if (!playerName) {
        alert('Ù…Ù† ÙØ¶Ù„Ùƒ Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ Ø£ÙˆÙ„Ø§Ù‹');
        return;
      }
      startGame();
    }

    cells.forEach(cell => cell.addEventListener('click', handleClick));
    resetBtn.addEventListener('click', resetGame);

    // ØªÙ‡ÙŠØ¦Ø©
    loadLeaderboard();
    updateLeaderboardDisplay();

  </script>

</body>
</html>